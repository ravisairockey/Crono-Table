<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>3D Astronomical Clock with Three.js Background</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=IM+Fell+DW+Pica&display=swap');
    * { margin:0; padding:0; box-sizing:border-box; }
    body, html { width:100%; height:100%; overflow:hidden; font-family:'IM Fell DW Pica', serif; }
    #three-container { position:fixed; top:0; left:0; width:100%; height:100%; z-index:0; }
    #app {
      position:relative;
      z-index:1;
      display:flex;
      height:100vh;
      color:#e4d5b7;
    }
    /* Clock left side */
    #clock-wrap {
      flex:1;
      perspective:800px;
      display:flex; align-items:center; justify-content:center;
    }
    .layer {
      position:absolute;
      top:50%; left:50%;
      width:60vmin; height:60vmin;
      margin:-30vmin 0 0 -30vmin;
      background-size:cover; background-position:center;
      transform-style:preserve-3d;
      transition:transform 0.1s ease-out;
      pointer-events:none;
      animation: breathe 5s ease-in-out infinite;
    }
    #layer-back    { background-image:url('images/back.jpg'); }
    #layer-gears   { background-image:url('images/gears.png'); background-size: contain; background-repeat: no-repeat; }
    #layer-astrol  { background-image:url('images/back.jpg'); }
    #layer-hands   { z-index:5; }
    .hand {
      position:absolute; transform-origin:50% 100%;
      top:50%; left:50%; background:#e4d5b7; border-radius:2px;
      transition:transform 0.05s linear;
    }
    #hour   { width:1vmin;  height:20vmin; margin:-20vmin 0 0 -0.5vmin; }
    #minute { width:0.8vmin;height:26vmin; margin:-26vmin 0 0 -0.4vmin; }
    #second { width:0.3vmin;height:30vmin; margin:-30vmin 0 0 -0.15vmin; background:#d28e2b; }
    #pivot {
      position:absolute; width:2vmin; height:2vmin; background:#e4d5b7;
      border-radius:50%; top:50%; left:50%; margin:-1vmin 0 0 -1vmin;
      box-shadow:0 0 1vmin rgba(0,0,0,0.7);
    }

    /* Timetable right side */
    #timetable {
      width:30vmin; max-width:350px;
      padding:2vmin;
      background:rgba(0,0,0,0.6);
      overflow-y:auto;
      font-size:1.2vmin;
    }
    #timetable h2 {
      font-size:2vmin; text-align:center; margin-bottom:1vmin;
      border-bottom:0.2vmin solid #d28e2b; padding-bottom:1vmin;
    }
    .event {
      display:flex; align-items:center; margin:1vmin 0;
      padding:0.5vmin 1vmin;
      border-left:0.5vmin solid #d28e2b;
      transition:background 0.3s, transform 0.2s;
    }
    .event.current { background:rgba(210,142,43,0.4); }
    .event:hover {
      background:rgba(255,255,255,0.1);
      transform:translateX(1vmin);
    }
    .time { width:7vmin; font-weight:bold; }

    /* Responsive */
    @media(max-width:768px){
      #app { flex-direction:column; }
      #timetable { width:100%; font-size:3vw; }
      .layer { width:80vmin; height:80vmin; margin:-40vmin 0 0 -40vmin; }
    }

    @keyframes breathe {
      0% { transform: scale(1); }
      50% { transform: scale(1.02); }
      100% { transform: scale(1); }
    }
  </style>
</head>
<body>
  <!-- Three.js Canvas -->
  <div id="three-container"></div>

  <!-- UI Layers & Timetable -->
  <div id="app">
    <div id="clock-wrap">
      <div id="layer-back"   class="layer"></div>
      <div id="layer-gears"  class="layer"></div>
      <div id="layer-astrol" class="layer"></div>
      <div id="layer-hands"  class="layer">
        <div id="hour"   class="hand"></div>
        <div id="minute" class="hand"></div>
        <div id="second" class="hand"></div>
        <div id="pivot"></div>
      </div>
    </div>
    <div id="timetable">
      <h2>Daily Timetable (IST, Chennai)</h2>
      <div id="events"></div>
    </div>
  </div>

  <!-- Three.js + OrbitControls from CDN -->
  <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.159.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.159.0/examples/jsm/"
      }
    }
  </script>
  <script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    // --- Three.js Scene Setup ---
    const container = document.getElementById('three-container');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera( 60, window.innerWidth/window.innerHeight, 0.1, 2000 );
    camera.position.set(0, 0, 400);

    const renderer = new THREE.WebGLRenderer({ antialias:true, alpha: true });
    renderer.setPixelRatio( window.devicePixelRatio );
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);

    const controls = new OrbitControls( camera, renderer.domElement );
    controls.enableZoom = false;
    controls.enablePan = false;


    // Ambient glow
    scene.add( new THREE.AmbientLight(0x888888) );

    // Starfield (Points)
    {
      const starGeo = new THREE.BufferGeometry();
      const count = 2000;
      const positions = new Float32Array(count * 3);
      for(let i=0; i<count*3; i++){
        positions[i] = (Math.random() - 0.5) * 2000;
      }
      starGeo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      const material = new THREE.PointsMaterial({ color:0xffffff, size:2, opacity:0.8, transparent:true });
      const stars = new THREE.Points(starGeo, material);
      scene.add(stars);
    }

    // Ember particles (sprite billboards)
    {
      const texture = new THREE.TextureLoader().load('https://threejs.org/examples/textures/sprites/spark1.png');
      const emberGeo = new THREE.BufferGeometry();
      const count = 500;
      const pos = new Float32Array(count*3);
      const sizes = new Float32Array(count);
      for(let i=0; i<count; i++){
        pos[3*i]   = (Math.random()-0.5)*1000;
        pos[3*i+1] = -200 + Math.random()*400;
        pos[3*i+2] = (Math.random()-0.5)*1000;
        sizes[i] = 10 + Math.random()*10;
      }
      emberGeo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
      emberGeo.setAttribute('size', new THREE.BufferAttribute(sizes,1));
      const emberMat = new THREE.PointsMaterial({
        map:texture,
        blending:THREE.AdditiveBlending,
        depthWrite:false,
        transparent:true,
        color:0xff6600
      });
      const embers = new THREE.Points(emberGeo, emberMat);
      scene.add(embers);
    }

    // Animate Three.js scene
    function animateBG(){
      requestAnimationFrame(animateBG);
      controls.update();
      renderer.render(scene, camera);
    }
    animateBG();

    // Handle resize
    window.addEventListener('resize', ()=>{
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    // --- Clock & Timetable Logic ---
    // Timetable data
    const startMin = 6 * 60;
    const activities = [
      {n:'Wake up',dur:4.45},{n:'Tea drinking',dur:4.2},{n:'After tea chit chat',dur:13.72},
      {n:'Restroom (dump)',dur:18.97},{n:'Learning',dur:157.82},{n:'Lunch + Anime/Games',dur:142.43},
      {n:'Study + Movies/TV',dur:143.97},{n:'Study again',dur:130.0},{n:'Bath',dur:10.97},
      {n:'Dinner',dur:86.97},{n:'Netflix and chill',dur:31.12},{n:'Play video games',dur:149.63}
    ];
    let offset = startMin;
    const evC = document.getElementById('events');
    activities.forEach(a=>{
      a.start = offset; a.end = offset + a.dur;
      const div = document.createElement('div');
      div.className = 'event';
      const sH = Math.floor(offset/60), sM=Math.floor(offset%60);
      div.innerHTML = `<span class="time">${String(sH).padStart(2,'0')}:${String(sM).padStart(2,'0')}</span><span>${a.n}</span>`;
      evC.appendChild(div);
      a.el = div;
      offset += a.dur;
    });

    // Parallax for clock layers
    const clockWrap = document.getElementById('clock-wrap');
    const layers = clockWrap.querySelectorAll('.layer');
    clockWrap.addEventListener('mousemove', e => {
      const r = clockWrap.getBoundingClientRect();
      const x = ((e.clientX - r.left)/r.width - 0.5)*2;
      const y = ((e.clientY - r.top)/r.height - 0.5)*2;
      layers.forEach((L,i)=>{
        const d = (i+1)*4;
        L.style.transform = `translate3d(${-x*d}vmin,${-y*d}vmin,0)`;
      });
    });

    // Update clock hands & highlight
    function update(){
      const nowUTC = Date.now() + new Date().getTimezoneOffset()*60000;
      const now = new Date(nowUTC + 19800000);
      const h = now.getHours()%12, m = now.getMinutes(), s = now.getSeconds();
      document.getElementById('hour').style.transform   = `rotate(${(h + m/60)*30}deg)`;
      document.getElementById('minute').style.transform = `rotate(${(m + s/60)*6}deg)`;
      document.getElementById('second').style.transform = `rotate(${s*6}deg)`;

      const total = now.getHours()*60 + now.getMinutes() + s/60;
      activities.forEach(a => a.el.classList.toggle('current', total >= a.start && total < a.end));
    }
    setInterval(update,1000);
    update();
  </script>
</body>
</html>
